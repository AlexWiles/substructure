// A2A Protocol type definitions.
// Source: https://github.com/a2aproject/A2A/blob/main/specification/a2a.proto
// Stripped: google.api annotations and service definition (transport-layer concerns).
syntax = "proto3";
package a2a;

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

// --- Core types ---

// `Part` represents a container for a section of communication content.
message Part {
  oneof content {
    string text = 1;
    bytes raw = 2;
    string url = 3;
    google.protobuf.Value data = 4;
  }
  google.protobuf.Struct metadata = 5;
  string filename = 6;
  string media_type = 7;
}

enum Role {
  ROLE_UNSPECIFIED = 0;
  ROLE_USER = 1;
  ROLE_AGENT = 2;
}

message Message {
  string message_id = 1;
  string context_id = 2;
  string task_id = 3;
  Role role = 4;
  repeated Part parts = 5;
  google.protobuf.Struct metadata = 6;
  repeated string extensions = 7;
  repeated string reference_task_ids = 8;
}

// --- Task lifecycle ---

enum TaskState {
  TASK_STATE_UNSPECIFIED = 0;
  TASK_STATE_SUBMITTED = 1;
  TASK_STATE_WORKING = 2;
  TASK_STATE_COMPLETED = 3;
  TASK_STATE_FAILED = 4;
  TASK_STATE_CANCELED = 5;
  TASK_STATE_INPUT_REQUIRED = 6;
  TASK_STATE_REJECTED = 7;
  TASK_STATE_AUTH_REQUIRED = 8;
}

message TaskStatus {
  TaskState state = 1;
  Message message = 2;
  google.protobuf.Timestamp timestamp = 3;
}

message Task {
  string id = 1;
  string context_id = 2;
  TaskStatus status = 3;
  repeated Artifact artifacts = 4;
  repeated Message history = 5;
  google.protobuf.Struct metadata = 6;
}

message Artifact {
  string artifact_id = 1;
  string name = 2;
  string description = 3;
  repeated Part parts = 4;
  google.protobuf.Struct metadata = 5;
  repeated string extensions = 6;
}

// --- Streaming events ---

message TaskStatusUpdateEvent {
  string task_id = 1;
  string context_id = 2;
  TaskStatus status = 3;
  google.protobuf.Struct metadata = 4;
}

message TaskArtifactUpdateEvent {
  string task_id = 1;
  string context_id = 2;
  Artifact artifact = 3;
  bool append = 4;
  bool last_chunk = 5;
  google.protobuf.Struct metadata = 6;
}

// --- Agent metadata ---

message AgentCard {
  string name = 1;
  string description = 2;
  repeated AgentInterface supported_interfaces = 3;
  AgentProvider provider = 4;
  string version = 5;
  optional string documentation_url = 6;
  AgentCapabilities capabilities = 7;
  map<string, SecurityScheme> security_schemes = 8;
  repeated SecurityRequirement security_requirements = 9;
  repeated string default_input_modes = 10;
  repeated string default_output_modes = 11;
  repeated AgentSkill skills = 12;
  repeated AgentCardSignature signatures = 13;
  optional string icon_url = 14;
}

message AgentInterface {
  string url = 1;
  string protocol_binding = 2;
  string tenant = 3;
  string protocol_version = 4;
}

message AgentProvider {
  string url = 1;
  string organization = 2;
}

message AgentCapabilities {
  optional bool streaming = 1;
  optional bool push_notifications = 2;
  repeated AgentExtension extensions = 3;
  optional bool extended_agent_card = 4;
}

message AgentExtension {
  string uri = 1;
  string description = 2;
  bool required = 3;
  google.protobuf.Struct params = 4;
}

message AgentSkill {
  string id = 1;
  string name = 2;
  string description = 3;
  repeated string tags = 4;
  repeated string examples = 5;
  repeated string input_modes = 6;
  repeated string output_modes = 7;
  repeated SecurityRequirement security_requirements = 8;
}

message AgentCardSignature {
  string protected = 1;
  string signature = 2;
  google.protobuf.Struct header = 3;
}

// --- Security ---

message SecurityRequirement {
  map<string, StringList> schemes = 1;
}

message StringList {
  repeated string list = 1;
}

message SecurityScheme {
  oneof scheme {
    ApiKeySecurityScheme api_key_security_scheme = 1;
    HttpAuthSecurityScheme http_auth_security_scheme = 2;
    OAuth2SecurityScheme oauth2_security_scheme = 3;
    OpenIdConnectSecurityScheme open_id_connect_security_scheme = 4;
    MutualTlsSecurityScheme mtls_security_scheme = 5;
  }
}

message ApiKeySecurityScheme {
  string description = 1;
  string location = 2;
  string name = 3;
}

message HttpAuthSecurityScheme {
  string description = 1;
  string scheme = 2;
  string bearer_format = 3;
}

message OAuth2SecurityScheme {
  string description = 1;
  OAuthFlows flows = 2;
  string oauth2_metadata_url = 3;
}

message OpenIdConnectSecurityScheme {
  string description = 1;
  string open_id_connect_url = 2;
}

message MutualTlsSecurityScheme {
  string description = 1;
}

message OAuthFlows {
  oneof flow {
    AuthorizationCodeOAuthFlow authorization_code = 1;
    ClientCredentialsOAuthFlow client_credentials = 2;
    ImplicitOAuthFlow implicit = 3;
    PasswordOAuthFlow password = 4;
    DeviceCodeOAuthFlow device_code = 5;
  }
}

message AuthorizationCodeOAuthFlow {
  string authorization_url = 1;
  string token_url = 2;
  string refresh_url = 3;
  map<string, string> scopes = 4;
  bool pkce_required = 5;
}

message ClientCredentialsOAuthFlow {
  string token_url = 1;
  string refresh_url = 2;
  map<string, string> scopes = 3;
}

message ImplicitOAuthFlow {
  string authorization_url = 1;
  string refresh_url = 2;
  map<string, string> scopes = 3;
}

message PasswordOAuthFlow {
  string token_url = 1;
  string refresh_url = 2;
  map<string, string> scopes = 3;
}

message DeviceCodeOAuthFlow {
  string device_authorization_url = 1;
  string token_url = 2;
  string refresh_url = 3;
  map<string, string> scopes = 4;
}

// --- Request/Response types ---

message SendMessageConfiguration {
  repeated string accepted_output_modes = 1;
  PushNotificationConfig push_notification_config = 2;
  optional int32 history_length = 3;
  bool blocking = 4;
}

message PushNotificationConfig {
  string id = 1;
  string url = 2;
  string token = 3;
  AuthenticationInfo authentication = 4;
}

message AuthenticationInfo {
  string scheme = 1;
  string credentials = 2;
}

message SendMessageRequest {
  string tenant = 1;
  Message message = 2;
  SendMessageConfiguration configuration = 3;
  google.protobuf.Struct metadata = 4;
}

message SendMessageResponse {
  oneof payload {
    Task task = 1;
    Message message = 2;
  }
}

message StreamResponse {
  oneof payload {
    Task task = 1;
    Message message = 2;
    TaskStatusUpdateEvent status_update = 3;
    TaskArtifactUpdateEvent artifact_update = 4;
  }
}

message GetTaskRequest {
  string tenant = 1;
  string id = 2;
  optional int32 history_length = 3;
}

message ListTasksRequest {
  string tenant = 1;
  string context_id = 2;
  TaskState status = 3;
  optional int32 page_size = 4;
  string page_token = 5;
  optional int32 history_length = 6;
  google.protobuf.Timestamp status_timestamp_after = 7;
  optional bool include_artifacts = 8;
}

message ListTasksResponse {
  repeated Task tasks = 1;
  string next_page_token = 2;
  int32 page_size = 3;
  int32 total_size = 4;
}

message CancelTaskRequest {
  string tenant = 1;
  string id = 2;
  google.protobuf.Struct metadata = 3;
}

message SubscribeToTaskRequest {
  string tenant = 1;
  string id = 2;
}

message TaskPushNotificationConfig {
  string tenant = 1;
  string task_id = 2;
  PushNotificationConfig push_notification_config = 3;
}

message CreateTaskPushNotificationConfigRequest {
  string tenant = 1;
  string task_id = 2;
  PushNotificationConfig config = 3;
}

message GetTaskPushNotificationConfigRequest {
  string tenant = 1;
  string task_id = 2;
  string id = 3;
}

message DeleteTaskPushNotificationConfigRequest {
  string tenant = 1;
  string task_id = 2;
  string id = 3;
}

message ListTaskPushNotificationConfigsRequest {
  string task_id = 1;
  int32 page_size = 2;
  string page_token = 3;
  string tenant = 4;
}

message ListTaskPushNotificationConfigsResponse {
  repeated TaskPushNotificationConfig configs = 1;
  string next_page_token = 2;
}

message GetExtendedAgentCardRequest {
  string tenant = 1;
}
